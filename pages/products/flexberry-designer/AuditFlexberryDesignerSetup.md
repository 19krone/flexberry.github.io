---
title: Настройка аудита в Flexberry Tool
sidebar: product--sidebar
keywords: Flexberry Audit, Flexberry Designer, How to (page), View (представление)
toc: true
permalink: ru/audit-Flexberry-setup.html
folder: product--folder
lang: ru
---

# Аудит
Настройка [аудита](audit-web.html) через Flexberry Tool осуществляется в несколько этапов:

## Настройка базы аудита
База аудита может храниться как в отдельной базе, так и в базе приложения.

Настройка совершается на форме настройки `[MS SQL Direct Generator](configure--m-s--s-q-l--server-direct-generator.html)` (см. пункт `БД аудита в БД приложения`). Также часть настроек базы данных находится в свойствах класса со стереотипом `[Application](application.html)`.

''__Примечание__: при использовании базы приложения в качестве хранилища для аудита __рекомедуется__ установить галочку `Не удалять существующие таблицы` на форме настройки `[MS SQL Direct Generator](configure--m-s--s-q-l--server-direct-generator.html)`, чтобы избежать проблем с приведением в соответствие базы данных и модели приложения.''

## Настройка стадии

Настройки аудита для стадии осуществляются на форме настроек Стадии на вкладке `Настройка аудита`

![Изображение](/images/img/page/AuditCaseberrySetup/AuditSettingsStady.PNG)

* `Вести аудит приложения` - необходимость вести аудит для всего приложения.


* `Режим записи аудита по умолчанию` - режим записи данных аудита в базу данных по умолчанию (синхронный или асинхронный). Будет устанавливаться для классов при генерации настроек аудита. Если в классе указана другая настройка, то для конкретно этого класса будет использоваться указанная в нем => приоритет настроек стадии меньше приоритета настроек класса.

''__Примечание__: на [первом этапе](devprocess_audit-stages.html) реализации аудита осуществляется только синхронная запись.''


* `Включить аудит во всех классах` - кнопка включения аудита во всех __существующих__ классах стадии. Включение аудита подразумевает установку настройки `Вести аудит класса`, создание представления `AuditView` и проставление настроек аудита по умолчанию.
Настройки по умолчанию предоставлены на скриншоте ниже (в разделе "Настройка классов").

Включают в себя:
** Установку настройки `Вести аудит класса`
** Установку настройки `Добавить поля аудита`
** Установку настройки `Вести аудит операции создания`
** Установку настройки `Вести аудит операции удаления`
** Установку настройки `Режим записи аудита` как `Синхронный`

При добавлении новых классов необходимо ручное включение аудита или повторное нажатие этой кнопки.
 По мере выполнения операции включения будет выводиться информация в лог.

## Настройка классов

Настройки аудита для классов осуществляются на форме настроек Класса на вкладке `Настройка аудита`

![Изображение](/images/img/page/AuditCaseberrySetup/AuditSettingsClass.PNG)

* `Вести аудит класса` - вести аудит для этого класса
* `Добавить поля аудита` - добавлять ли собственные поля аудита в поля класса. Полями аудита являются:
** `CreateTime` - дата создания объекта 
** `Creator` - создатель объекта, пользователь, создавший его
** `EditTime` - дата последнего изменения объекта
** `Editor` - редактор объекта, пользователь, изменивший его в последний раз


* `Использовать представление по умолчанию` - использовать для всех операций представление по умолчанию (представление по умолчанию является представление с именем `AuditView`
* `Вести аудит операции создания` - необходимость ведения аудита создания объектов
* `Имя представления для аудита операции создания` - представление, по которому будет вестись аудит создания объектов. Если указано представление по умолчанию, данная настройка игнорируется.
* `Вести аудит операции удаления` - необходимость ведения аудита удаления объектов
* `Имя представления для аудита операции удаления` - представление, по которому будет вестись аудит удаления объектов. Если указано представление по умолчанию, данная настройка игнорируется.
* `Вести аудит операции изменения` - необходимость ведения аудита изменения объектов
* `Имя представления для аудита операции изменения` - представление, по которому будет вестись аудит изменения объектов. Если указано представление по умолчанию, данная настройка игнорируется.
* `Вести аудит операции чтения` - необходимость ведения аудита чтения объектов
''__Примечание__: на [первом этапе](devprocess_audit-stages.html) реализации аудита эта функция не работает''
* `Имя представления для аудита операции чтения` - представление, по которому будет вестись аудит чтения объектов. Если указано представление по умолчанию, данная настройка игнорируется.
* `Путь к форме просмотра объекта` - ''опция пока недоступна'' путь к форме просмотра данных объекта. Дает возможность просмотреть каким был объект в определенное время (с формы просмотра аудита).
* `Режим записи аудита` - режим записи данных аудита в базу данных по умолчанию (синхронный или асинхронный).

## Настройка приложения

Настройки аудита для класса-приложения (со стереотипом [Application](application.html)) осуществляются на форме настроек Класса на вкладке `Настройка аудита`

![Изображение](/images/img/page/AuditWebExample/AuditAppSettings.PNG)

* `Имя строки соединения с БД аудита` - __имя__ строки соединения, которая будет передаваться в Win-сервис аудита, для указания на базу данных аудита.
* `Адрес сервиса аудита` - адрес, по которому располагается Win-сервис аудита.
* `Вести аудит сессий пользователей` - настройка ведения аудита сессий.

__Примечание__: данные настройки будут актуальны только после реализации [второго этапа](devprocess_audit-stages.html)


## AuditView - представление аудита
[Представление](view-definition.html) для аудита генерируется в момент нажатия кнопки `Включить аудит во всех класса` настройки стадии для всех классов данных. Также его можно создать вручную.

При изменении объекта будут сохраняться данные об изменении __полей__, находящихся в представлении `AuditView`.

Если ни одно из измененных __полей__ не попадает в представление, запись об изменении __объекта__ все равно создается.

Особым образом необходимо [формировать представление при наличии вычислимых свойств](not-stored-properties-and-audit.html).

# См. также
[Пример подключения подсистемы аудита к web-приложению](audit-web-example.html)
