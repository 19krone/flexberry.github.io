---
title: Модуль расширения History для Flexberry Designer
sidebar: product--sidebar
keywords: CASE Plugins
toc: true
permalink: ru/history-plugin.html
folder: product--folder
lang: ru
---
# Описание
Модуль расширения [Flexberry Designer](flexberry-designer.html): History разработан для хранения истории изменения Стадий с возможностью восстановления состояния стадии на момент сохранения.

# Возможности плагина
Плагин History позволяет выполнять следующий набор операций с записями об изменениях стадии:

# [#backup|Создание бэкапа стадии];
# [#backuphistory|Просмотр информации о созданных бэкапах]:
** Просмотр историй изменений стадий Конфигурации;
** Просмотр истории изменений конкретной стадии.
# [#recovery|Восстановление стадии]:
** Восстановление в текущую стадию;
** Восстановление в новую стадию;
** Восстановление в любую существующую стадию.
# [#compare|Сравнение двух записей истории]:
** Сравнение записи в истории с любой существующей стадией;
** Сравнение записи в истории с текущим состоянием стадии.
# Подключение модуля расширения
Подключение осуществляется по следующему алгоритму:

# Зарегистрировать плагин в Flexberry Designer;
#* Открыть меню `Настройки - Модули`;
#* Нажать &laquo;Создать&raquo;;
#* Указать путь к библиотеке `History Case Tool plugin.dll`.
# Добавить плагин к репозиторию:
#* Открыть свойства репозитория, выбрав пункт меню &laquo;`Репозиторий - Редактировать свойства`&raquo;;
#* В разделе Модули нажать &laquo;`Создать`&raquo;, в добавившейся строке в колонке `Модуль` выбрать &laquo;`HistoryPlugin`&raquo;;
#* Сохранить изменения.

(((<msg type=note head=Примечание>Подробнее о модулях и их подключении можно посмотреть в [этой статье](case-plugins.html).</msg>)))

После этого появится пункты меню Стадии `HistoryPlugin`:
* `История изменения стадии`;
* `Создать бекап`.
![](/images/pages/img/page/HistoryPlugin/Пункты добавленные плагином History.jpg)

Также, наряду с кнопками &laquo;`Сохранить`&raquo; и &laquo;`Сохранить и закрыть`&raquo; появится кнопка &laquo;`Сохранить с созданием бекапа`&raquo;, которая сохраняет стадию и автоматически создает для неё бекап.

[anchor|#backup]
# Создание бекапов
При создании бекапа создается запись о состоянии стадии на текущий момент. 

<msg type=note head=Примечание>Так как процесс создания бекапа для больших стадий занимает значительное время, не рекомендуется создавать бекапы при каждом внесении изменений в Стадию.</msg>

Создать бекап можно двумя способами:
# Выбрать пункт меню Стадии `HistoryPlugin - Создать бекап`;
![](/images/pages/img/page/HistoryPlugin/Пункт создать бэкап.jpg)
 
# Нажать на кнопку &laquo;`Сохранить с созданием бекапа`&raquo; на любой форме, привязанной к стадии (любая диаграмма, класс и пр.).
![](/images/pages/img/page/HistoryPlugin/Кнопка Сохранить с созданием бэкапа.jpg)

<msg type=note head=Примечание>Бекап создается для всей стадии сразу, независимо от формы, на которой была нажата кнопка &laquo;`Сохранить с созданием бекапа`&raquo;.
К примеру, если нажать эту кнопку на форме редактирования класса, то создастся бекап для всей стадии, к которой привязан этот класс, а не для класса и не для диаграммы.</msg>

[anchor|#backuphistory]
# Просмотр информации о бекапах
Созданные бекапы доступны на форме просмотра бекапов, которую можно открыть двумя способами:
# Выбрать пункт меню Конфигурации - `HistoryPlugin - История стадий конфигурации`.
Откроется форма просмотра бэкапов всех стадий выбранной Конфигурации.
![](/images/pages/img/page/HistoryPlugin/История стадий конфигурации.jpg)


Выбрать пункт меню Стадии `HistoryPlugin - История изменения стадии`.
Откроется форма просмотра бэкапов конкретной Стадии.
![](/images/pages/img/page/HistoryPlugin/Пункты добавленные плагином History.jpg)



На форме &laquo;История изменений стадии&raquo; представлен список с указанием:
* Даты создания бекапа;
* Пользователя, создавшего бекап;
* Операции, совершенной со стадией (Created, Changed, Deleted);
* PrimaryKey стадии;
* Наименования стадии;
* Пути до стадии.

![](/images/pages/img/page/HistoryPlugin/История изменений стадии.jpg)

[anchor|#recovery]
# Восстановление состояния стадии
При восстановлении стадии из записи истории производится разархивация и десериализация данных, хранящихся в поле Содержимое. При этом восстанавливаются все классы, ассоциации, представления и диаграммы стадии. Восстановление стадии может производиться в любую из существующих стадий, либо в новую стадию. При восстановлении в существующую стадию, она сначала удаляется, а затем в базу с тем же именем и ключом сохраняется восстановленная из истории стадия.

Для восстановления стадии из бекапа, необходимо на форме просмотра бекапов нажать кнопку &laquo;`Восстановить в текущую`&raquo;. Также можно восстановить бекап в любую другую, в том числе и новую стадию.

<msg type=note head=Примечание>При восстановлении Стадии текущая стадия удаляется и создается новая, поэтому в списке бекапов появляется еще одна запись. Отличительной особенностью таких записей является отсутствие информации в колонке `Имя стадии`.</msg>

## Алгоритм восстановления в текущую стадию
# Перейти на форму &laquo;История изменений стадии&raquo;:
**Выбрать пункт меню Стадии `HistoryPlugin - История изменения стадии`;
** Открылась форма &laquo;История изменений стадии&raquo;.
# Выделить строку бэкапа из которого нужно восстановить состояние стадии;
# В разворачивающемся списке на панели инструментов выбрать пункт &laquo;Восстановить в текущую&raquo;;
![](/images/pages/img/page/HistoryPlugin/Восстановить в текущую.jpg)
# Во всплвающем окне с предупреждением нажать ОК;
![](/images/pages/img/page/HistoryPlugin/Окно-предупреждение.jpg)

## Алгоритм восстановления состояния стадии, которая была удалена
# Выбрать пункт меню Конфигурации `HistoryPlugin - История стадий конфигурации`;
** Открылась форма &laquo;История изменений стадии&raquo;.
# Выделить строку бэкапа из которого нужно восстановить состояние удаленной стадии;
# В разворачивающемся списке на панели инструментов выбрать пункт &laquo;Восстановить как...&raquo;;
![](/images/pages/img/page/HistoryPlugin/Восстановить как.jpg)
# В появившемся окне указать имя, с которым стадия будет восстановлена. Далее есть несколько вариантов:
** Оставить имя, которое было у стадии до удаления. Стадия будет восстановлена со старым именем;
** Ввести новое имя. Стадия будет создана с новым именем;
** Выбрать существующую стадию из списка (данные в выбранной стадии будут перезаписаны!). 
![](/images/pages/img/page/HistoryPlugin/Выбрать имя стадии.jpg)
# Нажать ОК.

[anchor|#compare]


# Сравнение стадий
## Сравнение изменений между бэкапом стадии и текущим состоянием стадии
Доступно только из просмотра бэкапов конкретной стадии.
'''Алгоритм сравнения бэкапа стадии и текущим состоянием стадии'''
# Перейти на форму &laquo;История изменений стадии&raquo;;
# Выделить бэкап для сравнения, кликнув по строке правой клавишей мыши;
#  Выбрать в раскрывающемся списке пункт &laquo;Сравнить с текущей&raquo;;
# Будут открыты окно с логом выполнения сравнения и [#result|окно с результатом сравнения].
![](/images/pages/img/page/HistoryPlugin/Сравнить с текущей.jpg)


## Сравнение двух бэкапов одной стадии/кофигурации
Для сравнения двух стадий, необходимо на форме просмотра бекапов выделить 2 бекапа и нажать кнопку `Сравнить`.
Таким способом можно сравнить два бэкапа одной стадии, или бэкапы двух разных стадий, находящихся в одной конфигурации. 
Доступно из просмотра бэкапов конкретной стадии и из просмотра бэкапов стадий конфигурации.

'''Алгоритм сравнения двух бэкапов:'''
# Перейти на форму &laquo;История изменений стадии&raquo;;
# Выделить первый бэкап, кликнув по строке правой клавишей мыши;
# Выделить второй бэкап, зажав Ctrl и кликнув правой клавишей мыши по другой строке;
# Выбрать в раскрывающемся списке пункт &laquo;Сравнить&raquo;;
![](/images/pages/img/page/HistoryPlugin/Сравнение двух бэкапов.jpg)
# Будут открыты окно с логом выполнения сравнения и [#result|окно с результатом сравнения].


## Сравнение бэкапа стадии с текущим состоянием любой другой стадии.
Позволяет сравнить сохраненное состояние стадии, с текущим состоянием другой стадии в данном Репозитории, даже если она находится в другой Конфигурации или другом Проекте.
Доступно из просмотра бэкапов конкретной стадии и из просмотра бэкапов стадий конфигурации.

Алгоритм сравнения бэкапа стадии с текущим состоянием любой другой стадии:
* Перейти на форму &laquo;История изменений стадии&raquo;;
* Выбрать бэкап, для которого необходимо провести сравнение (выбрана только 1 строка);
* Выбрать в раскрывающемся списке пункт &laquo;Сравнить&raquo;;
* В открывшемся окне из списка всех существующих в данном репозитории стадий выбрать ту, с которой будем сравнивать.
![](/images/pages/img/page/HistoryPlugin/Сравнить со стадией.jpg)
* Нажать ОК.
* Будут открыты окно с логом выполнения сравнения и [#result|окно с результатом сравнения].


[anchor|#result]
## Отображение результатов сравнения
Результаты сравнения отображаются на форме:

![](/images/pages/img/page/HistoryPlugin/Отображение результатов сравнения.jpg)

На форме мы видим между какими стадиями происходит сравнение. Подписан путь для каждой стадии в формате Репозиторий/Проект/Конфигурация/Стадия
Ниже доступны для  просмотра 5 вкладок:
# Результат сравнения (при открытии формы мы находимся на ней);
# Объекты совпадают;
# Объекты только стадии 1;
# Объекты различаются;
# Объекты только стадии 2.

'''Вкладка &laquo;Результат сравнения&raquo;. '''
Здесь в виде круговой диаграммы выводится информация о процентном соотношении совпадающих, различающихся и уникальных для каждой стадии классов (Classes) и представлений (Views).
* Голубым цветом на диаграмме показываются классы и представления представленные только в первой сравниваемой стадии (Стадия 1). Детальную информацию о них можно получить на вкладке &laquo;Объекты только стадии 1&raquo;
* Желтым цветом на диаграмме показываются классы и представления представленные только во второй сравниваемой стадии (Стадия 2). Детальную информацию о них можно получить на вкладке &laquo;Объекты только стадии 2&raquo;
* Красным цветом на диаграмме показываются классы и представления, которые есть в обеих сравниваемых стадиях и являются одинаковыми. Детальную информацию о них можно получить на вкладке &laquo;Совпадают&raquo;
* Синим цветом на диаграмме показываются классы и представления, которые есть в обеих сравниваемых стадиях, но имеют некоторые отличия. Получить детальную информацию о них и посмотреть, в чем именно состоят отличия можно на вкладке &laquo;Совпадают&raquo;
![](/images/pages/img/page/HistoryPlugin/Диаграмма сравнения.jpg)

'''Вкладка &laquo;Объекты различаются&raquo;. '''
Здесь находится информация о классах и представлениях, которые есть в обеих сравниваемых стадиях, но имеют некоторые отличия.
Перейдя на вкладку мы видим таблицу, в которой в столбце &laquo;Тип объекта&raquo; видим 2 раскрывающихся списка с классами (Classes) и представлениями (Views). В столбце &laquo;Наименование объекта&raquo;, напротив свернутых списков написано количество найденных классов и представлений имеющих отличия.
![](/images/pages/img/page/HistoryPlugin/Количество отличающихся объектов.jpg)

Раскроем список Classes и выберем один из найденных классов, например &laquo;Дом&raquo;.

В нижнем окне есть 2 вкладки: &laquo;Поля&raquo; и &laquo;Ассоциации&raquo;.
 
Вкладка &laquo;Поля&raquo; позволяет посмотреть какие поля имеет класс в стадии 1 и в стадии 2. Показан стереотип, родитель, значения атрибутов. Элементы, которых нет в одной из сравниваемых стадий выделены красным цветом.
![](/images/pages/img/page/HistoryPlugin/Класс - поля. Сравнение.jpg)


Вкладка &laquo;Ассоциации&raquo; позволяет посмотреть какие у данного класса есть мастеры, детейлы, агрегаторы, роли, кардинальность связи. Элементы, которых нет в одной из сравниваемых стадий выделены красным цветом.
''P.S. В данном примере у класса &laquo;Дом&raquo; нет отличий в ассоциациях. ''
![](/images/pages/img/page/HistoryPlugin/Класс - Ассоциации. Сравнение.jpg)


Раскроем список Views и выберем одно из найденных представлений, например &laquo;Заказ.ЗаказЕ&raquo;.
Вкладка &laquo;Свойства&raquo; позволяет посмотреть какие свойства имеет представление в стадии 1 и в стадии 2. Элементы, которых нет в одной из сравниваемых стадий выделены красным цветом.
![](/images/pages/img/page/HistoryPlugin/Views сравнение - Свойства.jpg)


Вкладка &laquo;Детейлы&raquo; позволяет посмотреть какие Детейлы имеет представление в стадии 1 и в стадии 2. Элементы, которых нет в одной из сравниваемых стадий выделены красным цветом. В данном примере представление &laquo;Заказ.ЗаказЕ&raquo не имеет детейлов в стадии TestStandWin.
![](/images/pages/img/page/HistoryPlugin/Views сравнение - Детейлы.jpg)
