---
title: Редактирование детейлов в отдельном роуте во Flexberry Groupedit
sidebar: ember-flexberry_sidebar
keywords: Flexberry Ember
toc: true
permalink: en/ef_groupedit-detail-in-route.html
folder: products/ember-flexberry/controls/groupedit/
lang: en
summary: Описаны настройки, которые необходимо произвести, чтобы править детейлы на отдельных [роутах](ef_route.html) во [Flexberry Groupedit](ef_groupedit.html).
---

## Описание

Часто детейлы на [форме редактирования](ef_edit-form.html) корректируются непосредственно внутри контрола [Flexberry Groupedit](ef_groupedit.html), однако в некоторых случаях (например, при работе на мобильных устройствах) есть потребность редактировать детейл на отдельном роуте, при этом:

* Изменения в агрегаторе и детейлах сохраняются в БД только при нажатии кнопки "Сохранить" на форме агрегатора.
* На странице детейла есть только две кнопки: "Сохранить" и "Закрыть" (на форме нет кнопки, чтобы откатить состояние детейла на момент захода на форму).
* При нажатии на кнопку "Сохранить" на странице детейла происходит возврат на страницу агрегатора без сохранения изменений в БД.

Для того, чтобы включить редактирование детейлов в отдельном роуте, требуется следующее.

## Настройка шаблона агрегатора и роутера

В [шаблоне](ef_template.html) формы редактирования агрегатора у контрола [Flexberry Groupedit](ef_groupedit.html) определить следующие свойства:

```hbs
{% raw %}
{{flexberry-groupedit
  ...
  rowClickable=true
  rowClick='rowClick'
  editOnSeparateRoute=true
}}{% endraw %}
```

`rowClickable` - флаг, определяющий, следует ли обрабатывать нажатие на строчку. По умолчанию имеет значение "false", для редактирования детейла в отдельном роуте нужно задать "true".

`rowClick` - действие, выполняемое при нажатии на строчку. По умолчанию имеет значение "rowClick", для редактирования детейла в отдельном роуте нужно, чтобы действие (action) с заданным в свойстве именем было определено в [контроллере](ef_controller.html) или [роуте](ef_route.html) ("rowClick" определено в базовом [роуте](ef_route.html) [формы редактирования](ef_edit-form.html)).

''__ВАЖНО__'': Текущий обработчик метода `rowClick` реализован таким образом, что в случае, если детейл сохранён, то будет произведена переадресация на роут как "modelName/:id", а если не сохранён, то "modelName.new" (соответственно, [роутер](ef_router.html) должен быть настроен, чтобы переадресация могла пройти корректно).

`editOnSeparateRoute` - флаг, определяющий, следует ли редактировать детейл в отдельном роуте. По умолчанию имеет значение "false". При задании значения "true" изменяется внешний вид контрола [Flexberry Groupedit](ef_groupedit.html) (отключается возможность редактирования непосредственно в контроле, при нажатии на кнопку "Добавить" теперь создаётся новая запись и сразу происходит переадресация на роут редактирования.


## Настройка шаблона детейла

Чтобы была возможность редактировать детейл в отдельном роуте, соответствующая форма должна быть создана.

Если предполагается, что форма редактирования детейла может быть использована не только с формы агрегатора, но и со списковой формы детейлов, то для настройки отображения кнопок "Сохранить", "Удалить", "Закрыть" можно использовать [условия, представленные в статье](ef_edit-form.html).

## Настройка контроллера детейла

[Контроллер](ef_controller.html) формы редактирования детейла должен наследоваться от "detail-edit-form" вместо "edit-form". В "detail-edit-form" присутствует дополнительная логика, организующая корректное взаимодействие между формами агрегатора и детейла. В случае, если определено, что пользователь попал на форму детейла не с формы агрегатора, то будет выполняться логика базового контроллера "edit-form".

```javascript
import DetailEditFormController from 'ember-flexberry/controllers/detail-edit-form';

export default DetailEditFormController;
```

## Настройка моделей агрегатора и детейла

При [описании модели](efd_model.html) агрегатора важно проверить, что проставлена детейловая [inverse-связь](https://guides.emberjs.com/v2.4.0/models/relationships/#toc_reflexive-relations).

```javascript
var Model = BaseModel.extend({
  ...
  orders: DS.hasMany('order', { inverse: 'employee', async: false }),
});
```

При [описании модели](efd_model.html) детейла важно проверить, что проставлена [inverse-связь](https://guides.emberjs.com/v2.4.0/models/relationships/#toc_reflexive-relations) на агрегатора.

```javascript
var Model = BaseModel.extend({
  ...
  employee: DS.belongsTo('employee', { inverse: 'orders', async: false })
});
```

## Настройка сериализатора агрегатора

Важно, чтобы [сериализаторы для агрегатора и детейла были настроены корректно](efd_serializer.html).

## Дополнительные особенности реализации

* У базового контроллера формы редактирования есть свойство `returnToAgregatorRoute`, которое определяет, следует ли производить настройки для потенциального возвращения на предыдущий роут агрегатора. По умолчанию в базовом контроллере значение "false". В базовом контроллере детейла данное значение переопределено на "true" (при необходимости можно в прикладном контроллере детейла поменять его обратно на "false", чтобы не происходило возвращение). Вычитка данного флага происходит в [методе роута setupController](http://devdocs.io/ember/classes/ember.route#method_setupController).
* Для организации сохранения информации между роутами агрегатора и детейла используется специальный сервис detail-interaction. Данный сервис не предназначен для использования на прикладных проектах.
* В базовый роут формы редактирования миксинится свойство newRoutePath, где определяется, каким образом по роуту модели определяется роут для новой записи. Сейчас метод реализован как "currentPath + '.new'". Потенциально этот метод можно переопределить на прикладном роуте.

## Редактирование детейлов в отдельном роуте во Flexberry Groupedit с сохранением

Существует режим работы контрола [Flexberry Groupedit](ef_groupedit.html), при котором редактирование детейла происходит на отдельном [роуте](ef_route.html), при этом при переходе с роута агрегатора на роут детейла происходит сохранение агрегатора, а при переходе обратно - сохранение детейла.

Настройка данного варианта аналогичная описываемому выше способу. В шаблоне контрола при этом нужно выставить один дополнительный флаг `saveBeforeRouteLeave`.

```hbs
{% raw %}
{{flexberry-groupedit
  ...
  rowClickable=true
  rowClick='rowClick'
  editOnSeparateRoute=true
  saveBeforeRouteLeave=true
}}{% endraw %}
```

`saveBeforeRouteLeave` - флаг, определяющий, следует ли сохранять текущую модель при переходах между агрегатором и детейлом. По умолчанию имеет значение "false".

О том, как функционируют кнопки на такой детейловой форме, описано в [отдельной статье](ef_edit-form.html).
