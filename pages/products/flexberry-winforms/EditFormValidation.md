




## Валидация данных

Валидация данных происходит в несколько этапов.

`Web`:
* Во-первых, нужны по-максимуму клиентские валидаторы (jQuery). Эти валидаторы должны блокировать отправку формы на сервер, если что-то не заполнено или заполнено неправильно (так мы снижаем нагрузку на сервер и увеличиваем отзывчивость и интерактивность приложения). Если это простой `required`, то можно использовать [http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basevalidator%28v=vs.100%29.aspx|ASP.NET-валидатор) с включенным клиентским обработчиком – тогда jQuery-валидаторы не нужны. Главное правильно указать `[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basevalidator.validationgroup%28v=vs.100%29.aspx|ValidationGroup)`. 


* После клиентских валидаторов нужно использовать серверные и разместить на форме `[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.validationsummary%28v=vs.100%29.aspx|ValidationSummary)`, в который надо выводить красивые сообщения об ошибках. 


* Третий рубеж – [BSExample|бизнес-сервер). Он тоже нужен, так как логика может быть не только на форме и проверять её, как правило, надо всегда. Форма, в отличие от остальных потенциальных «вызывальщиков», ответ от бизнес-сервера должна преобразовать в понятный вид и показать пользователю. Для этого рекомендуется обработать отличным от стандартного образом событие сохранения объекта в методе `Save` и `SaveAndClose` через блока `try-catch`. В `catch` поймать сообщение от бизнес-сервера (желательно типизированное) и сообщить пользователю о проблемах. Это можно сделать либо через сообщение в [WebErrorBox-and-ErrorForm|WebErrorBox), либо отметкой на странице, либо ещё как-нибудь.

`Windows`:
По аналогии со сценарием для Web:
* Проверки [CheckFormFieldDuringEdit|во время редактирования) на форме.
* Проверки [CheckFormFieldDuringSave|во время сохранения) объекта.
* Проверки в [BSExample|бизнес-сервере).

<msg type=note head=Примечание>Чтобы сгенерировать код формы редактирования (или списка), необходимо в свойствах класса со [Формы-редактирования-классы-со-стереотипом-editform|стереотипом EditForm) установить флажок `GenerateDependedForm`.</msg>

{| cellspacing="0" cellpadding="2" border="1"
! Приём !! Преимущества !! Недостатки
|- class="tablerow"
| [CheckFormFieldDuringEdit|во время редактирования) || + позволяет оперативно сообщать пользователю о некорректности значения в каком-то поле || - не позволяет в полной мере проверять сложные взаимосвязи между полями объекта и другими объектами
|- class="tablerow"
| [CheckFormFieldDuringSave|во время сохранения) || + позволяет проверять сложные взаимосвязи между полями объекта, поскольку проверка происходит единовременно || - проверка начинается только при попытке сохранения формы
|- class="tablerow"
| [BSExample|в бизнес-сервере) || + позволяет проверять сложные взаимосвязи между полями объекта, а также связи с другими объектами ||  - проверка начинается только при попытке сохранения формы
|}

Общие замечания по реализации экранных форм редактирования можно посмотреть [++Прикладные системы.Реализация-пользовательского-интерфеиса-экранных-форм-редактирования|здесь).



## Итого

Самым предпочтительным вариантом является реализация проверок __на всех уровнях__.

## Сценарии доработки

* Настроить [Check-NotNull-fields|проверку обязательности полей).
* Добавить ограничение числа вводимых символов для строковых контролов и допустимый диапазон для числовых контролов.
* Проставить [FeaturesOfDafaultValueAssignment|значения по умолчанию).
* Добавить проверку [BSUniqueDataCheck|уникальности номеров), [funcBetween|диапазонов дат).









