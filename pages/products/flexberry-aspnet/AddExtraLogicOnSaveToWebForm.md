---
title: Добавление дополнительной логики при сохранении объекта на Web-форме редактирования
sidebar: product--sidebar
keywords: 
toc: true
permalink: ru/add-extra-logic-on-save-to-web-form.html
folder: product--folder
lang: ru
---
# Обработка события сохранения объекта на клиенте
В клиентских обработчиках событий нажатия на кнопки сохранения, расположенных на Web-форме редактирования, перед отправкой постбэка и сохранением объекта выполняется проверка редактируемых данных в технологическом коде (валидаторы контролов, [AjaxGroupEdit](ajax-group-edit.html)).

Стандартный процесс проверки редактируемых данных может быть расширен за счет добавления обработчиков событий с помощью функции `$.icsEditForm.attachEventHandler`. Возможно добавление обработчиков следующих событий:

{|
! Событие !! Описание
|-
| `onCheckStarts` || Инициируется перед началом проверки редактируемых данных в технологическом коде. В обработчике данного события возможно отменить последующее сохранение редактируемых данных или инициировать выполнение асинхронных операций, которые должны завершиться до выполнения проверки редактируемых данных в технологическом коде (за счет передачи Deferred-объектов через параметр обработчика данного события в технологический обработчик события сохранения объекта).
|-
| `onCheckStopped` || Инициируется в случае отмены сохранения данных в обработчике события onCheckStarts.
|-
| `onCheckSucceed` || Инициируется в случае успешного выполнения проверки редактируемых данных в технологическом коде.
|-
| `onCheckFailed` || Инициируется в случае неуспешного выполнения проверки редактируемых данных в технологическом коде или в случае перевода в состояние "отменено" хотя бы одного из Deferred-объектов, созданных в обработчике события `onCheckStarts`.
|-
| `onCheckProgress` || Инициируется в случае получения уведомлений о прогрессе от одного из Deferred-объектов, созданных в обработчике события `onCheckStarts`.
|}

## Функция `$.icsEditForm.attachEventHandler`

Функция `$.icsEditForm.attachEventHandler` принимает два параметра:
{|
! Параметр !! Описание
|-
| `handler` || Функция-обработчик события.
|-
| `eventName` || Имя события. Если не указано, то регистрируется обработчик события `onCheckStarts`.
|}


## Обработчик события `onCheckStarts`

Обработчик события `onCheckStarts` принимает один параметр - объект, у которого имеются два свойства:
{|
! Свойство !! Описание
|-
| `stop` || Логическое свойство, которое позволяет отменить выполнение технологического обработчика сохранения объекта при нажатии на кнопку сохранения, в случае установки значения `true`.
|-
| `deferreds` || Массив Deferred-объектов для возможности выполнения асинхронных операций до выполнения проверки редактируемых данных в технологическом коде. Обработчик события сохранения объекта, определенный в технологическом коде, выполнится только в том случае, если все Deferred-объекты, добавленные в данный массив, перейдут в состояние "выполнено" (т.е. будет вызван метод `resolve()` для каждого их них). В случае перевода хотя бы одного такого Deferred-объекта в состояние "отменено" проверка редактируемых данных в технологическом коде и последующее инициирование процесса сохранения объекта выполнено не будет, но будет выполнен обработчик события `onCheckFailed`.
|}


# Пример добавления дополнительной логики при сохранении объекта

```javascript
$(function() {
    // Регистрация пользовательского обработчика события onCheckStarts.
    $.icsEditForm.attachEventHandler(function(p) {
        var d1 = $.Deferred();
        p.deferreds.push(d1);

        // Функция $.ics.dialog.confirm - асинхронная.
        // Технологический обработчик сохранения объекта будет приостановлен до тех пор, пока объект d1 не перейдет в состояние "выполнено" или "отменено".
        $.ics.dialog.confirm({
            message: 'Данные изменены. Сохранить изменения?',
            callback: function (res) {
                if (!res) {
                    // В этом случае выполнится проверка редактируемых данных в технологическом коде и последующее сохранение объекта в случае успешного завершения проверки.
                    d1.reject();
                } else {
                    // В этом случае выполнится обработчик события onCheckFailed, определенный ниже.
                    d1.resolve();
                }
            }
        });
    });

    // Выполнение действий в случае перевода объекта d1 в состояние "отменено" или в случае возникновения ошибок при проверке данных в технологическом коде.
    $.icsEditForm.attachEventHandler(function (p) {
        // ...
    }, 'onCheckFailed');
});
```

