---
title: Межформенное взаимодействие в Web-приложениях
sidebar: product--sidebar
keywords: Flexberry ASP-NET
toc: true
permalink: ru/form-interaction-web.html
folder: product--folder
lang: ru
---


# Сценарий открытия страницы редактирования со списка
Адрес страницы редактирования определяется настройкой `[WebObjectListView](web-object-list-view.html)`.`EditPage`. На страницу посылаются параметры через адресную строку:
* `Mode` - режим открытия страницы, может быть `readonly`.
* `ReturnUrl` - адрес возврата, содержит не только адрес страницы, но и адрес WOLV, с которого была вызвана страница редактирования.
* `DataObject` - передается вместе с POST запросом (передается через Request.Form&#0091;"DataObject"&#0093;). Хранит в себе сериализованный в XML экземпляр нового объекта (подробнее см. [эту статью](open-edit-form-web-example.html)).
* `PK` - первичный ключ редактируемого объекта.

(((<msg type=note>Если объект новый, то при первом открытии `PK` не посылается, однако, при первом сохранении объекта (без возврата на страницу со списком), этот параметр появляется в адресной строке.</msg>)))

Страница редактирования наследуется от `[BaseEditForm](base-edit-form.html)&lt;T&gt;`.

При загрузке страницы срабатывает несколько виртуальных методов BaseEditForm, которые можно переопределить на странице редактирования:

# `PreLoad()` - метод вызывается самым первым в методе `Page_Load()`.
# `PrepareDataObject` - подготовка объекта к выгрузке на страницу. В этом методе (на BaseEditForm) происходит вычитка объекта по `PK`, или десериализация из POST-запроса (XML). Не рекомендуется переопределять этот метод.
# `PreApplyToControls()` - метод вызывается перед "размазыванием" данных объекта по контролам страницы. На момент вызова этого метода объект уже вычитан из базы (либо при PostBack'e значения уже записаны в объект), можно совершить какие-то дополнительные манипуляции с объектом прежде чем его значения попадут на страницу.
# `AfterApplyToControl()` - метод вызывается после "размазывания" данных объекта по контролам страницы. На момент вызова этого метода все контролы на странице уже обновлены в соответствии с данными объекта. Также метод вызывается после сохранения объекта (подробнее см. ниже).
# `PostApplyToControl()` - вызывается сразу за `AfterApplyToControls()`
# `PostLoad()` - вызывается самым последним при загрузке страницы.

# Сценарий сохранения объекта
Последовательность срабатывания методов при нажатии кнопки "Сохранить":

# javaScript метод `saveBtnClickHandler` (файл: ~\shared\script\jquery.icsEditForm.js)
#* Запуск ASP.NET валидаторов
#* Запуск установленных прикладными разработчикаи обработчиков события сохранения
#* Ручная отправка PostBack'а на сервер
# Серверный виртуальный метод `SaveBtn_Click` - обработчик нажатия на кнопку сохранения `BaseEditForm`.
#* `PreSave()` - виртуальный метод, срабатывающий перед фактическим сохранением объекта. Возвращает значение типа `bool`, если возвращено значение `false`, то объект не уйдет на сохранение.
#* `SaveObject()` - виртуальный метод, в котором происходит непосредственно сохранение объекта. Не рекомендуется переопределять этот метод без вызова базового метода.
#* `PostSaveObject()` - виртуальный метод, срабатывающий после сохранения объекта. На момент вызова метода объект уже попадает в базу, следовательно срабатывает бизнес-сервер обновления этого объекта и все изменения, происходящие с объектом в бизнес-сервере уже доступны. Сразу после вызова этого метода происходит "размазывание" данных объекта по контролам.
#* `AfterApplyToControls()` - метод, описанный в блоке `Сценарий открытия страницы редактирования со списка`.
# Если на момент вызова метода сохранения объект был новый (то есть его не было в базе), то происходит редирект на эту же самую страницу редактирования, но в адресную строку добавляется `PrimaryKey` объекта.

(((<msg type=note>Если страница не проходит валидацию, данные на сервер не отправляются вовсе. Таким образом снижается нагрузка на сервер, однако стоит понимать, что серверный обработчик кнопки сохранения не сработает, если страница не прошла валидацию.</msg>)))

# Лукапы
## Сценарий открытия страницы со списком на лукап
Настройки лукапов:
* `LimitFunction` - ограничение, накладываемое на отображаемые на открываемой странице-лукапе данные.
* `LookUpFormURL` - адрес страницы, которая вызовается на лукап. По умолчанию смотрит на `LookUpForm`.

(((<msg type=note>На странице должен быть WOLV с установленной настройкой `LookUp = true;`, а также должен происходить разбор передаваемых через адресную строку параметров. Подробнее см. [LookUpForm](look-up-form.html)</msg>)))

При открытии сираницы на лукап передается адрес контрола, с которого он был инициирован (страница, а также местоположение самого контрола). Также передается PrimaryKey выбранного объекта (если такой был на момент открытия лукапа) для подсветки его на открываемой странице.

## Сценарий выбора значения мастера на лукап-странице
При выборе какого-либо объекта на списке лукап-страницы происходит возврат PrimaryKey этого объекта по адресу, отправленному при открытии лукап-страницы.

После возврате значения на списковую форму, при необходимости, заполняются поля выбранного мастера.

# См. также
[Межформенное взаимодействие в Windows-приложениях](form-interaction.html)
