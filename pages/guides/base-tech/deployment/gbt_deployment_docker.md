---
title: Разворачивание решений в контейнерах Docker
keywords: Programming
sidebar: guide-base-tech_sidebar
toc: true
permalink: ru/gbt_deployment_docker.html
folder: base-tech/deployment
lang: ru
---

## Описание

docker это легковесная система контейнеризации приложений с открытым исходным кодом.
На настоящий момент в существует несколько сотен типов Linux-дистрибутивов. Каждый тип Linux-дистрибутива имеет свои особенности в установке и настройке приложений:
* Различия в процедуре установки пакетов (apt-get, yum, dnf, ...).
* Различия пакетной базы (нужный пакет может отсутствовать).
* Название пакета, его версия и механизм установки могут отличаться.
* Пакеты собраны с различными опциями и расширениями.
* Файлы конфигурации располагаются в различных местах.
* ...

Все это создает серъезные проблемы при переносе работающего приложения с одного типа Linux-дистрибутива на другой.

Docker решает эту проблему путем создания образа файловой системы, включающего кроме самого приложения все необходимые библиотеки и файлы конфигурации. Таким образом установив образ docker-приложения, созданный для одного типа дистрибутива (например Ubuntu) Вы можете на его основе запустить контейнер выполняющий приложение на другом дистрибутиве (например ALTLinux).

В отличие от других систем виртуализации (например Virtuozzo/OpenVZ) docker-приложения одного типа дистрибутива за счет использования каскадно-объединенного (послойного) монтирования используют одни и те же библиотеки, файлы конфигурации базового дистрибутива. Это позволяет оптимально использовать файловую систему, снизить объем ресурсов, потребляемых контнейнеров и увеличить время его запуска.
Этот же механизм позволяет довольно просто создвать собственные образы путем расширения (наследования) существующих образов создавая таким образом дерево образов дитсрибутивов.

Несомненным достоинством docker является наличие на настоящий момент сотен официальных образов и до полумиллиона неофициальных публичных образов на портале [docker-образов](https://hub.docker.com/). Найдя необходимый образ приложения Вы можете его установить на свой компьютер и на его основе запускать контейнеры приложения не заботясь о несовместимости Linux-дистрибутивов.

Кроме этого Вы можете расширив полученный образ создать собственный образ приложения добавив в него свои файлы конфигурации и дополнительные пакеты.

Например, если Вам необходимо запустить Ваше MPI-программу, Вы можете скачать образ MPI-компилятора от CentOS:

```sh
# docker pull nersc/centos-mpi
```

Создать собственный подобраз, воспользовавшись инструкцией, приведенной на странице [образа](https://hub.docker.com/r/nersc/centos-mpi/) и запускать Ваше MPI-приложение в различными параметрами, на различных Linux-дистрибутивах.

Кроме этого при запуске контейнеры Вы можете передавать в него различные параметры, привязыват TCP-порты приложения контейнера к различных портам HOST-системы, монтировать каталоги HOST-системы в подкаталоги контейнера. 

Все эти механизмы позволяют запускать в рамках одной ОС:
* несколько  контейнеров с одним приложением одной версии;
* несколько контейнеров версий различных версий одного приложения;
* приложения, конфликтующих по TCP-портам или файловой системе
* и т.п.

### Запуск контейнера Apache: kafnevod/altlinux.p8-apache2 

Допустим Вам необходимо запустить Ember-приложение под WEB-сервером Apache2. 
Вы скачиваете образ сервера для дистрибутива ALTLinux P8:

```sh
docker pull kafnevod/altlinux.p8-apache2
```

Запуск контейнера производится командой:

```sh
# docker run -d -p 80:80 --name=apache2 kafnevod/altlinux.p8-apache2
```
Контейнер запускается в режиме демона (-d) с именем (--name) apache2 и с привязкой порта (-p) 80 контейнера к порту 80 HOST-системы.

Для проверки работоспособности контейнера запустите команду:

```sh
# docker ps -f name=apache2
```

Команда отобразить строку типа:
```
CONTAINER ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS                NAMES
688acc21b881        kafnevod/altlinux.p8-apache2   "/usr/sbin/httpd2 -D "   5 seconds ago       Up 4 seconds        0.0.0.0:80->80/tcp   apache2
```

Столбец IMAGE содержит имя образа контейнера.
Столбец NAMES - имя контейнера.
Столбец CONTAINER ID - идентификатор (UID) контейнера.
Столбец PORTS список привязанны портов контейнера с портам HOST-системы.
Столбец STATUS - статус контейнера (start, up, restart, ...).
Столбец STATUS - время с момента запуска контейнера. 
Столбец COMMAND - имя и параметры запуска корневого процесса контейнера.

Используя параметр exec команды docker Вы можете запустить собственный процесс в рамках работающего контейнера. Например команда pstree (дерево процессов):

```sh
# docker exec apache2 pstree
```
Выведет результат:

```

httpd2---2*[httpd2---26*[{httpd2}]]

```

Вы также можете запустить bash-интепретатор в рамках контейнера:
```sh
docker exec -it apache2 bash
```

и в интерактивном режиме поработать в рамках контейнера.
Например динамически просматривать лог-файлы apache2-сервера командой:

```sh
# tail -f /var/log/httpd2/*log
```
### Проверка работы контейнера Apache: kafnevod/altlinux.p8-apache2 

Для проверки работы контейнера наберите в строке браузера URL: http://localhost/.
В окне браузера отобразится текст: **It works!**

Если Вы в контейнере запустили вышеуказанную коменду просмотра логов **tail**, она выведет строки типа:

```
==> /var/log/httpd2/access_log <==
172.18.0.1 - - [26/Dec/2016:10:25:17 +0000] "GET / HTTP/1.1" 200 45
```

### Запуск собственного виртуальног сайта в рамках контейнера Apache

Файл описания виртуальных сайтов apache2-сервера контейнера находится в файле /conf/vhosts.conf образа.
Для запуска собственного виртуального сайта (например demo) Вы должны 
* поместить деревов сайта в отдельный каталог (например /var/www/vhosts/demo/) HOST-системы;
Пусть это будет простая тестовая страница /var/www/vhosts/demo/index.html:

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
  <title>Тестовая demo-страница для проверки работоспособности виртуального хоста в контейнере kafnevod/altlinux.p8-apache2</title>
  </head>
  <body>
    <b><i>Виртуальный хост demo.local контейнера kafnevod/altlinux.p8-apache2 работает!</i></b>
  </body>
</html>
```

* опишите конфигурацию этого виртуального хоста в файле конфигурации vhosts.conf отдельного каталога. Например /etc/docker/apache2/conf/vhosts.conf:

```
NameVirtualHost *:80
<VirtualHost *:80>
        DocumentRoot "/var/www/vhosts/demo/"
        ServerName demo.local
        ErrorLog "/var/log/httpd2/demo_log"
        CustomLog "/var/log/httpd2/demo_log" common
</VirtualHost>
```

* Удалите работающий контейнер, если он у Вас запущен:

```sh
# docker rm -f apache2
```

* Запустите новый контейнер командой:

```sh
docker run -d \
  -p 80:80 \
  --name=apache2Virt \
  -v /etc/docker/apache2/conf/:/conf/ \
  -v /var/www/vhosts/:/var/www/vhosts/ \
  kafnevod/altlinux.p8-apache2
```

Параметры -v монтируют каталог конфигурации /conf/ и каталог виртуальных сайтов /var/www/vhosts/ контейнера на каталоги /etc/docker/apache2/conf/, /var/www/vhosts/ HOST-системы.

* опишите виртуальный домен в файле /etc/hosts:

```
127.0.0.1 demo.local ... localhost
```

>Если Вы запускаете контейнер на удаленном сервере, то вместо адреса 127.0.0.1 в файле /etc/hosts хоста где Вы запускаете браузер вы должны добавить строчку:

```
ip-адрес_сервера demo.local
```

>Если Вы запускаете виртуальный сайт для внешнего доступа, то вместо правки файла /etc/hosts зарегистритуйте домен (например demo.ics.perm.ru) у провайдера домена и укажите его в описании конфигурации файла /etc/docker/apache2/conf/vhosts.conf.

* Для проверки работы виртуального сайта наберите в строке браузера URL: http://demo.local/.
В окне браузера отобразится текст: **_Виртуальный хост demo.local контейнера kafnevod/altlinux.p8-apache2 работает!_**


### Установка и запуск контейнера Mono/.NET-приложений kafnevod/altlinux.p8-apache2-mono4.6.2.7

Для запуска mono-приложений загрузите образ kafnevod/altlinux.p8-apache2-mono4.6.2.7:
```
```



## Ссылки на материалы для изучения


### Лекции, курсы, презентации, видео

### Рекомендованные книги

## Программное обеспечение

## Лабораторные работы и практические задания

## Возможности по сертификации

## Перейти
* [Главная страница курса](gbt_landing-page.html)
